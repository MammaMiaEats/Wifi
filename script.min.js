document.addEventListener("DOMContentLoaded",()=>{const CONFIG={app:{name:"Mamma Mia Eats",version:"2.1.0",lastUpdate:"2025-04-27 23:59:59",author:"MammaMiaEats"},urls:{connect:"/connect",redirect:"https://instagram.com/MammaMiaEats"}},elements={form:document.getElementById("access-form"),connectBtn:document.getElementById("connect-btn"),termsInput:document.getElementById("terms_accepted"),termsLink:document.getElementById("terms-link"),modal:document.getElementById("terms-modal"),modalCloseBtn:document.querySelector(".close-button"),modalCloseFooter:document.getElementById("close-terms")},state={isConnecting:!1,termsAccepted:!1},UI={setLoading:e=>{const t=elements.connectBtn;t.innerHTML=e?'<i class="fas fa-circle-notch fa-spin"></i> Conectando...':'<span class="button-text">Conectar</span><i class="fas fa-arrow-right"></i>',t.disabled=e||!state.termsAccepted},showError:e=>{alert(e||"Ocorreu um erro. Tente novamente.")},updateButtonState:()=>{elements.connectBtn.disabled=!state.termsAccepted}},Modal={show:()=>{elements.modal.style.display="flex",elements.modal.setAttribute("aria-hidden","false"),setTimeout(()=>elements.modal.classList.add("active"),10)},hide:()=>{elements.modal.classList.remove("active"),elements.modal.setAttribute("aria-hidden","true"),setTimeout(()=>elements.modal.style.display="none",300)}};window.selectOption=e=>{elements.termsInput.value=e,document.querySelectorAll(".radio-button").forEach(e=>e.classList.remove("selected"));const t=document.querySelector(`.radio-button.${"yes"===e?"accept":"decline"}`);t&&t.classList.add("selected"),state.termsAccepted="yes"===e,UI.updateButtonState()},elements.form.addEventListener("submit",async e=>{if(e.preventDefault(),!state.termsAccepted)return UI.showError("Você precisa aceitar os termos de uso para continuar.");if(state.isConnecting)return;state.isConnecting=!0,UI.setLoading(!0);try{const e=new FormData(elements.form),t=await fetch(CONFIG.urls.connect,{method:"POST",body:e});if(!t.ok)throw new Error(`Erro de conexão (${t.status})`);const n=await t.json();if(n.success)window.location.href=n.redirect_url||CONFIG.urls.redirect;else throw new Error(n.message||"Erro ao conectar")}catch(e){console.error("Erro:",e),UI.showError(e.message)}finally{state.isConnecting=!1,UI.setLoading(!1)}}),elements.termsLink.addEventListener("click",e=>{e.preventDefault(),Modal.show()}),elements.modalCloseBtn.addEventListener("click",Modal.hide),elements.modalCloseFooter.addEventListener("click",Modal.hide),window.addEventListener("click",e=>{e.target===elements.modal&&Modal.hide()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&Modal.hide()})});
